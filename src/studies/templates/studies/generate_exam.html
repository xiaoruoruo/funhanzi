{% extends "studies/base.html" %}

{% block title %}Generate Exam{% endblock %}

{% block content %}
<div>
    <h1>Generate {{ exam_type }} Exam</h1>

    <form method="post">
        {% csrf_token %}

        <div class="mb-3">
            <label for="num_chars" class="form-label">Number of characters:</label>
            <input type="number" class="form-control" id="num_chars" name="num_chars" value="{{ default_num_chars }}"
                min="1" required>
            <div class="form-text">
                {% if exam_type == 'read_review' or exam_type == 'write_review' %}
                Number of due characters to include in the review exam. Only characters that are due for review will be
                selected.
                {% else %}
                Number of characters to include in the exam.
                {% endif %}
            </div>
        </div>

        {% if exam_type != 'read_review' and exam_type != 'write_review' %}
        {% include "studies/includes/book_selector_fields.html" %}

        <div class="mb-3">
            <label for="score_filter" class="form-label">Score filter (optional):</label>
            <input type="number" class="form-control" id="score_filter" name="score_filter" 
                   {% if default_score_filter is not None %}value="{{ default_score_filter }}"{% endif %}>
            <div class="form-text">If provided, exclude characters with scores higher than this value.</div>
        </div>

        <div class="mb-3">
            <label for="days_filter" class="form-label">Days filter (optional):</label>
            <input type="number" class="form-control" id="days_filter" name="days_filter" 
                   {% if default_days_filter is not None %}value="{{ default_days_filter }}"{% endif %}>
            <div class="form-text">If provided, exclude characters that were studied within this many days.</div>
        </div>
        {% endif %}

        <div class="mb-3">
            <label for="title" class="form-label">Title:</label>
            <input type="text" class="form-control" id="title" name="title" value="{{ default_title }}">
        </div>

        <div class="mb-3">
            <label for="header_text" class="form-label">Header text:</label>
            <input type="text" class="form-control" id="header_text" name="header_text"
                value="{{ default_header_text }}">
        </div>

        <button type="submit" class="btn btn-primary">Generate Exam</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const lessonScopeSelect = document.getElementById('lesson_scope');
        const specificLessonContainer = document.getElementById('specific_lesson_container');

        function toggleSpecificLesson() {
            if (lessonScopeSelect && specificLessonContainer) {
                if (lessonScopeSelect.value === 'specific') {
                    specificLessonContainer.style.display = 'block';
                } else {
                    specificLessonContainer.style.display = 'none';
                }
            }
        }

        if (lessonScopeSelect) {
            lessonScopeSelect.addEventListener('change', toggleSpecificLesson);
            toggleSpecificLesson();
        }
    });
</script>
{% endblock %}